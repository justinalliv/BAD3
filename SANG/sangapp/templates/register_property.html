{% extends 'base.html' %}

{% block title %}Register Property - Supreme Biotech Solutions{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 640px;
    }

    .form-card h1 {
        color: #1a2a5e;
        font-size: 2em;
        margin-bottom: 30px;
        text-align: center;
    }

    .address-label {
        color: #666;
        font-weight: 600;
        margin-bottom: 12px;
    }

    .error-message {
        color: #d32f2f;
        font-size: 0.85em;
        margin-top: 5px;
        display: block;
    }

    input.error,
    select.error {
        border-color: #d32f2f;
    }

    .form-select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23666' d='M1.41 0L6 4.58 10.59 0 12 1.41 6 7.41 0 1.41z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        padding-right: 40px;
        background-color: white;
    }

    .success-container {
        text-align: center;
        padding: 40px 20px;
    }

    .success-icon {
        width: 60px;
        height: 60px;
        background-color: #28a745;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        color: white;
        font-size: 2em;
    }

    .success-text {
        color: #1a2a5e;
        font-size: 1.05em;
        margin-bottom: 25px;
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-card">
        {% if success %}
            <div class="success-container">
                <div class="success-icon">âœ“</div>
                <p class="success-text">You have successfully registered a property. You may now proceed to booking an inspection.</p>
                <a href="{% url 'property_list' %}" class="btn btn-primary">Back to Properties</a>
            </div>
        {% else %}
            <h1>Register Property</h1>

            <form id="propertyForm" method="POST">
                {% csrf_token %}

                {% if errors.general %}
                    <div class="error-message" style="margin-bottom: 15px; text-align: center;">{{ errors.general }}</div>
                {% endif %}

                <div class="form-group">
                    <label for="property_name">Property Name</label>
                    <input type="text" id="property_name" name="property_name" placeholder="XX Dolor St., Sit Amet" value="{{ form_data.property_name }}" {% if errors.property_name %}class="error"{% endif %}>
                    {% if errors.property_name %}<span class="error-message">{{ errors.property_name }}</span>{% endif %}
                </div>

                <div class="address-label">Property Address</div>

                <div class="form-row">
                    <div class="form-group">
                        <input type="text" id="street_number" name="street_number" placeholder="Street/Unit No." value="{{ form_data.street_number }}" {% if errors.street_number %}class="error"{% endif %}>
                        {% if errors.street_number %}<span class="error-message">{{ errors.street_number }}</span>{% endif %}
                    </div>
                    <div class="form-group">
                        <input type="text" id="street" name="street" placeholder="Street" value="{{ form_data.street }}" {% if errors.street %}class="error"{% endif %}>
                        {% if errors.street %}<span class="error-message">{{ errors.street }}</span>{% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <input type="text" id="city" name="city" placeholder="City" value="{{ form_data.city }}" {% if errors.city %}class="error"{% endif %}>
                        {% if errors.city %}<span class="error-message">{{ errors.city }}</span>{% endif %}
                    </div>
                    <div class="form-group">
                        <input type="text" id="province" name="province" placeholder="Province" value="{{ form_data.province }}" {% if errors.province %}class="error"{% endif %}>
                        {% if errors.province %}<span class="error-message">{{ errors.province }}</span>{% endif %}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <input type="text" id="zip_code" name="zip_code" placeholder="Zip Code" value="{{ form_data.zip_code }}" {% if errors.zip_code %}class="error"{% endif %}>
                        {% if errors.zip_code %}<span class="error-message">{{ errors.zip_code }}</span>{% endif %}
                    </div>
                    <div class="form-group">
                        <input type="text" id="country" name="country" placeholder="Country" value="{{ form_data.country }}" {% if errors.country %}class="error"{% endif %}>
                        {% if errors.country %}<span class="error-message">{{ errors.country }}</span>{% endif %}
                    </div>
                </div>

                <div class="form-group">
                    <label for="property_type">Type of Property</label>
                    <select id="property_type" name="property_type" class="form-select {% if errors.property_type %}error{% endif %}">
                        <option value="">Select Property Type</option>
                        <option value="Residential" {% if form_data.property_type == 'Residential' %}selected{% endif %}>Residential</option>
                        <option value="Commercial" {% if form_data.property_type == 'Commercial' %}selected{% endif %}>Commercial</option>
                        <option value="Industrial" {% if form_data.property_type == 'Industrial' %}selected{% endif %}>Industrial</option>
                        <option value="Agricultural" {% if form_data.property_type == 'Agricultural' %}selected{% endif %}>Agricultural</option>
                        <option value="Mixed Use" {% if form_data.property_type == 'Mixed Use' %}selected{% endif %}>Mixed Use</option>
                    </select>
                    {% if errors.property_type %}<span class="error-message">{{ errors.property_type }}</span>{% endif %}
                </div>

                <div class="form-group">
                    <label for="floor_area">Floor Area (in sqm)</label>
                    <input type="number" id="floor_area" name="floor_area" step="0.01" placeholder="XXX" value="{{ form_data.floor_area }}" {% if errors.floor_area %}class="error"{% endif %}>
                    {% if errors.floor_area %}<span class="error-message">{{ errors.floor_area }}</span>{% endif %}
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="openCancelModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="openConfirmModal()">Confirm Registration</button>
                </div>
            </form>
        {% endif %}
    </div>
</div>

<div id="cancelModal" class="modal">
    <div class="modal-content">
        <h2>Cancel Registration of Property?</h2>
        <p>Are you sure you want to cancel? Your recently made changes will be reset.</p>
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-cancel" onclick="closeCancelModal()">Continue Editing</button>
            <button class="modal-btn modal-btn-confirm" onclick="confirmCancel()">Confirm</button>
        </div>
    </div>
</div>

<div id="confirmModal" class="modal">
    <div class="modal-content">
        <h2>Confirm Property Registration?</h2>
        <p>Please review your property information before confirming the registration.</p>
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-cancel" onclick="closeConfirmModal()">Continue Editing</button>
            <button class="modal-btn modal-btn-confirm" onclick="submitForm()">Confirm</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function openCancelModal() {
        document.getElementById('cancelModal').classList.add('show');
    }

    function closeCancelModal() {
        document.getElementById('cancelModal').classList.remove('show');
    }

    function confirmCancel() {
        window.location.href = "{% url 'property_list' %}";
    }

    function openConfirmModal() {
        const form = document.getElementById('propertyForm');
        const inputs = form.querySelectorAll('input[type="text"], input[type="number"], select');
        let allFilled = true;

        inputs.forEach(input => {
            if (!input.value.trim()) {
                allFilled = false;
                input.classList.add('error');
            } else {
                input.classList.remove('error');
            }
        });

        if (allFilled) {
            document.getElementById('confirmModal').classList.add('show');
            return;
        }

        alert('Please fill in all required fields.');
    }

    function closeConfirmModal() {
        document.getElementById('confirmModal').classList.remove('show');
    }

    function submitForm() {
        document.getElementById('propertyForm').submit();
    }

    window.addEventListener('click', function(event) {
        const cancelModal = document.getElementById('cancelModal');
        const confirmModal = document.getElementById('confirmModal');

        if (event.target === cancelModal) {
            closeCancelModal();
        }

        if (event.target === confirmModal) {
            closeConfirmModal();
        }
    });
</script>
{% endblock %}