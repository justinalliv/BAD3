{% extends 'base.html' %}

{% block title %}Register Property - Supreme Biotech Solutions{% endblock %}

{% block extra_css %}
    .form-card h1 {
        color: #1a2a5e;
        font-size: 2em;
        margin-bottom: 30px;
        text-align: center;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-row.full {
        grid-template-columns: 1fr;
    }

    .error-message {
        color: #e74c3c;
        font-size: 0.85em;
        margin-top: 5px;
        display: block;
    }

    input.error,
    select.error {
        border-color: #e74c3c;
    }

    .success-container {
        text-align: center;
        padding: 40px 20px;
    }

    .success-icon {
        width: 60px;
        height: 60px;
        background-color: #28a745;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        color: white;
        font-size: 2em;
    }

    .success-text {
        color: #1a2a5e;
        font-size: 1.1em;
        margin-bottom: 30px;
    }
{% endblock %}

{% block base_nav %}
<!-- Navigation Bar -->
    <nav class="nav-spacious">
        <div class="nav-logo">
            <svg width="40" height="40" viewBox="0 0 40 40" style="fill: #1a2a5e;">
                <circle cx="20" cy="10" r="4"/>
                <path d="M 20 14 Q 15 18 20 26 Q 25 18 20 14 Z"/>
                <circle cx="15" cy="22" r="1.5"/>
                <circle cx="25" cy="22" r="1.5"/>
            </svg>
            Supreme
        </div>

        <ul class="nav-links">
            <li><a href="{% url 'customer_home' %}">Home</a></li>
            <li><a href="{% url 'book_inspection' %}">Book Inspection</a></li>
            <li><a href="{% url 'property_list' %}">Manage Properties</a></li>
            <li><a href="{% url 'service_status' %}">Service Status</a></li>
        </ul>

        <a href="{% url 'profile' %}" class="profile-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <circle cx="10" cy="6" r="4"/>
                <path d="M 4 18 Q 4 12 10 12 Q 16 12 16 18 Z"/>
            </svg>
            Profile
        </a>
    </nav>
{% endblock %}

{% block content %}
    <!-- Main Content -->
    <div class="container">
        <div class="form-card">
            {% if success %}
                <!-- Success State -->
                <div class="success-container">
                    <div class="success-icon">âœ“</div>
                    <p class="success-text">You have successfully registered a property. You may now proceed to booking an inspection.</p>
                    <a href="{% url 'property_list' %}" class="confirm-btn" style="text-decoration: none; display: inline-block;">Back to Properties</a>
                </div>
            {% else %}
                <!-- Form -->
                <h1>Register Property</h1>

                <form id="propertyForm" method="POST">
                    {% csrf_token %}

                    {% if errors.general %}
                        <div style="color: #e74c3c; margin-bottom: 20px; text-align: center;">{{ errors.general }}</div>
                    {% endif %}

                    <!-- Property Name -->
                    <div class="form-group form-row full">
                        <div>
                            <label for="property_name">Property Name</label>
                            <input 
                                type="text" 
                                id="property_name" 
                                name="property_name" 
                                placeholder="XX Dolor St., Sit Amet"
                                value="{{ form_data.property_name }}"
                                {% if errors.property_name %}class="error"{% endif %}
                            >
                            {% if errors.property_name %}<span class="error-message">{{ errors.property_name }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Property Address -->
                    <div style="color: #666; font-weight: 600; margin-bottom: 15px;">Property Address</div>

                    <div class="form-row">
                        <div>
                            <label for="street_number">Street/Unit No.</label>
                            <input 
                                type="text" 
                                id="street_number" 
                                name="street_number"
                                value="{{ form_data.street_number }}"
                                {% if errors.street_number %}class="error"{% endif %}
                            >
                            {% if errors.street_number %}<span class="error-message">{{ errors.street_number }}</span>{% endif %}
                        </div>
                        <div>
                            <label for="street">Street</label>
                            <input 
                                type="text" 
                                id="street" 
                                name="street"
                                value="{{ form_data.street }}"
                                {% if errors.street %}class="error"{% endif %}
                            >
                            {% if errors.street %}<span class="error-message">{{ errors.street }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="city">City</label>
                            <input 
                                type="text" 
                                id="city" 
                                name="city"
                                value="{{ form_data.city }}"
                                {% if errors.city %}class="error"{% endif %}
                            >
                            {% if errors.city %}<span class="error-message">{{ errors.city }}</span>{% endif %}
                        </div>
                        <div>
                            <label for="province">Province</label>
                            <input 
                                type="text" 
                                id="province" 
                                name="province"
                                value="{{ form_data.province }}"
                                {% if errors.province %}class="error"{% endif %}
                            >
                            {% if errors.province %}<span class="error-message">{{ errors.province }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="zip_code">Zip Code</label>
                            <input 
                                type="text" 
                                id="zip_code" 
                                name="zip_code"
                                value="{{ form_data.zip_code }}"
                                {% if errors.zip_code %}class="error"{% endif %}
                            >
                            {% if errors.zip_code %}<span class="error-message">{{ errors.zip_code }}</span>{% endif %}
                        </div>
                        <div>
                            <label for="country">Country</label>
                            <input 
                                type="text" 
                                id="country" 
                                name="country"
                                value="{{ form_data.country }}"
                                {% if errors.country %}class="error"{% endif %}
                            >
                            {% if errors.country %}<span class="error-message">{{ errors.country }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Type of Property -->
                    <div class="form-group form-row full">
                        <div>
                            <label for="property_type">Type of Property</label>
                            <select 
                                id="property_type" 
                                name="property_type"
                                {% if errors.property_type %}class="error"{% endif %}
                            >
                                <option value="">Select Property Type</option>
                                <option value="Residential" {% if form_data.property_type == 'Residential' %}selected{% endif %}>Residential</option>
                                <option value="Commercial" {% if form_data.property_type == 'Commercial' %}selected{% endif %}>Commercial</option>
                                <option value="Industrial" {% if form_data.property_type == 'Industrial' %}selected{% endif %}>Industrial</option>
                                <option value="Agricultural" {% if form_data.property_type == 'Agricultural' %}selected{% endif %}>Agricultural</option>
                                <option value="Mixed Use" {% if form_data.property_type == 'Mixed Use' %}selected{% endif %}>Mixed Use</option>
                            </select>
                            {% if errors.property_type %}<span class="error-message">{{ errors.property_type }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Floor Area -->
                    <div class="form-group form-row full">
                        <div>
                            <label for="floor_area">Floor Area (in sqm)</label>
                            <input 
                                type="number" 
                                id="floor_area" 
                                name="floor_area"
                                step="0.01"
                                placeholder="XXX"
                                value="{{ form_data.floor_area }}"
                                {% if errors.floor_area %}class="error"{% endif %}
                            >
                            {% if errors.floor_area %}<span class="error-message">{{ errors.floor_area }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="button-group">
                        <button type="button" class="cancel-btn" onclick="openCancelModal()">Cancel</button>
                        <button type="button" class="confirm-btn" onclick="openConfirmModal()">Confirm Registration</button>
                    </div>
                </form>
            {% endif %}
        </div>
    </div>

    <!-- Cancel Confirmation Modal -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <h2>Cancel Registration of Property?</h2>
            <p>Are you sure you want to cancel? Your recently made changes will be reset.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeCancelModal()">Continue Editing</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmCancel()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Registration Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Confirm Property Registration?</h2>
            <p>Please review your property information before confirming the registration.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeConfirmModal()">Continue Editing</button>
                <button class="modal-btn modal-btn-confirm" onclick="submitForm()">Confirm</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
        function openCancelModal() {
            document.getElementById('cancelModal').classList.add('show');
        }

        function closeCancelModal() {
            document.getElementById('cancelModal').classList.remove('show');
        }

        function confirmCancel() {
            window.location.href = "{% url 'property_list' %}";
        }

        function openConfirmModal() {
            // Validate form before showing modal
            const form = document.getElementById('propertyForm');
            const inputs = form.querySelectorAll('input[type="text"], input[type="number"], select');
            let allFilled = true;

            inputs.forEach(input => {
                if (!input.value.trim()) {
                    allFilled = false;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });

            if (allFilled) {
                document.getElementById('confirmModal').classList.add('show');
            } else {
                alert('Please fill in all required fields.');
            }
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        function submitForm() {
            document.getElementById('propertyForm').submit();
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const cancelModal = document.getElementById('cancelModal');
            const confirmModal = document.getElementById('confirmModal');
            
            if (event.target === cancelModal) {
                closeCancelModal();
            }
            if (event.target === confirmModal) {
                closeConfirmModal();
            }
        });
    </script>
{% endblock %}
