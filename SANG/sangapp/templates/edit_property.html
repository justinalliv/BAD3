{% extends 'base.html' %}

{% block title %}Update Property - Supreme Biotech Solutions{% endblock %}

{% block extra_css %}
        /* Main Content */
        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .form-card {
            background-color: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-card h1 {
            color: #1a2a5e;
            font-size: 2em;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: border-color 0.3s;
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-color: #fff;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23666' d='M1.41 0.59L6 5.17 10.59 0.59 12 2l-6 6-6-6z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 40px;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #1a2a5e;
            box-shadow: 0 0 0 2px rgba(26, 42, 94, 0.1);
        }

        input[type="text"]:disabled,
        input[type="number"]:disabled {
            background-color: #f5f5f5;
            color: #999;
            cursor: not-allowed;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.85em;
            margin-top: 5px;
            display: block;
        }

        input.error,
        select.error {
            border-color: #e74c3c;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .cancel-btn {
            background-color: #e0e0e0;
            color: #333;
            padding: 12px 40px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .cancel-btn:hover {
            background-color: #d0d0d0;
        }

        .confirm-btn {
            background-color: #1a2a5e;
            color: white;
            padding: 12px 40px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .confirm-btn:hover {
            background-color: #0d1535;
        }

        /* Success State */
        .success-message {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }

        .success-container {
            text-align: center;
            padding: 40px 20px;
        }

        .success-icon {
            width: 60px;
            height: 60px;
            background-color: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2em;
        }

        .success-text {
            color: #1a2a5e;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .modal-content h2 {
            color: #1a2a5e;
            margin-bottom: 15px;
        }

        .modal-content p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 30px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95em;
        }

        .modal-btn-cancel {
            background-color: #e0e0e0;
            color: #333;
            transition: background-color 0.3s;
        }

        .modal-btn-cancel:hover {
            background-color: #d0d0d0;
        }

        .modal-btn-confirm {
            background-color: #1a2a5e;
            color: white;
            transition: background-color 0.3s;
        }

        .modal-btn-confirm:hover {
            background-color: #0d1535;
        }

        /* Responsive */
{% endblock %}

{% block base_nav %}
<!-- Navigation Bar -->
    <nav class="nav-spacious">
        <div class="nav-logo">
            <svg width="40" height="40" viewBox="0 0 40 40" style="fill: #1a2a5e;">
                <circle cx="20" cy="10" r="4"/>
                <path d="M 20 14 Q 15 18 20 26 Q 25 18 20 14 Z"/>
                <circle cx="15" cy="22" r="1.5"/>
                <circle cx="25" cy="22" r="1.5"/>
            </svg>
            Supreme
        </div>

        <ul class="nav-links">
            <li><a href="{% url 'customer_home' %}">Home</a></li>
            <li><a href="{% url 'book_inspection' %}">Book Inspection</a></li>
            <li><a href="{% url 'property_list' %}">Manage Properties</a></li>
            <li><a href="{% url 'service_status' %}">Service Status</a></li>
        </ul>

        <a href="{% url 'profile' %}" class="profile-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <circle cx="10" cy="6" r="4"/>
                <path d="M 4 18 Q 4 12 10 12 Q 16 12 16 18 Z"/>
            </svg>
            Profile
        </a>
    </nav>
{% endblock %}

{% block content %}
    <!-- Main Content -->
    <div class="container">
        <div class="form-card">
            {% if success %}
                <!-- Success State -->
                <div class="success-container">
                    <div class="success-icon">âœ“</div>
                    <p class="success-text">Property information updated successfully.</p>
                    <a href="{% url 'property_list' %}" class="confirm-btn" style="text-decoration: none; display: inline-block;">Back to Properties</a>
                </div>
            {% else %}
                <!-- Form -->
                <h1>Update Property</h1>

                <form id="propertyForm" method="POST">
                    {% csrf_token %}

                    {% if errors.general %}
                        <div style="color: #e74c3c; margin-bottom: 20px; text-align: center;">{{ errors.general }}</div>
                    {% endif %}

                    <!-- Property ID (Read-only) -->
                    <div class="form-row">
                        <div>
                            <label for="property_id">Property ID</label>
                            <input 
                                type="text" 
                                id="property_id"
                                value="{{ property.id }}"
                                disabled
                            >
                        </div>
                        <div>
                            <label for="property_name">Property Name</label>
                            <input 
                                type="text" 
                                id="property_name" 
                                name="property_name" 
                                placeholder="XX Dolor St., Sit Amet"
                                value="{{ form_data.property_name }}"
                                {% if errors.property_name %}class="error"{% endif %}
                            >
                            {% if errors.property_name %}<span class="error-message">{{ errors.property_name }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Property Address -->
                    <div style="color: #666; font-weight: 600; margin-bottom: 15px;">Property Address</div>

                    <div class="form-row">
                        <div>
                            <label for="street_number">Street/Unit No.</label>
                            <input 
                                type="text" 
                                id="street_number" 
                                name="street_number"
                                value="{{ form_data.street_number }}"
                                {% if errors.street_number %}class="error"{% endif %}
                            >
                            {% if errors.street_number %}<span class="error-message">{{ errors.street_number }}</span>{% endif %}
                        </div>
                        <div>
                            <label for="street">Street</label>
                            <input 
                                type="text" 
                                id="street" 
                                name="street"
                                value="{{ form_data.street }}"
                                {% if errors.street %}class="error"{% endif %}
                            >
                            {% if errors.street %}<span class="error-message">{{ errors.street }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="city">City</label>
                            <input 
                                type="text" 
                                id="city" 
                                name="city"
                                value="{{ form_data.city }}"
                                {% if errors.city %}class="error"{% endif %}
                            >
                            {% if errors.city %}<span class="error-message">{{ errors.city }}</span>{% endif %}
                        </div>
                        <div>
                            <label for="province">Province</label>
                            <input 
                                type="text" 
                                id="province" 
                                name="province"
                                value="{{ form_data.province }}"
                                {% if errors.province %}class="error"{% endif %}
                            >
                            {% if errors.province %}<span class="error-message">{{ errors.province }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="zip_code">Zip Code</label>
                            <input 
                                type="text" 
                                id="zip_code" 
                                name="zip_code"
                                value="{{ form_data.zip_code }}"
                                {% if errors.zip_code %}class="error"{% endif %}
                            >
                            {% if errors.zip_code %}<span class="error-message">{{ errors.zip_code }}</span>{% endif %}
                        </div>
                        <div>
                            <label for="country">Country</label>
                            <input 
                                type="text" 
                                id="country" 
                                name="country"
                                value="{{ form_data.country }}"
                                {% if errors.country %}class="error"{% endif %}
                            >
                            {% if errors.country %}<span class="error-message">{{ errors.country }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Type of Property -->
                    <div class="form-group form-row full">
                        <div>
                            <label for="property_type">Type of Property</label>
                            <select 
                                id="property_type" 
                                name="property_type"
                                {% if errors.property_type %}class="error"{% endif %}
                            >
                                <option value="">Select Property Type</option>
                                <option value="Residential" {% if form_data.property_type == 'Residential' %}selected{% endif %}>Residential</option>
                                <option value="Commercial" {% if form_data.property_type == 'Commercial' %}selected{% endif %}>Commercial</option>
                                <option value="Industrial" {% if form_data.property_type == 'Industrial' %}selected{% endif %}>Industrial</option>
                                <option value="Agricultural" {% if form_data.property_type == 'Agricultural' %}selected{% endif %}>Agricultural</option>
                                <option value="Mixed Use" {% if form_data.property_type == 'Mixed Use' %}selected{% endif %}>Mixed Use</option>
                            </select>
                            {% if errors.property_type %}<span class="error-message">{{ errors.property_type }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Floor Area -->
                    <div class="form-group form-row full">
                        <div>
                            <label for="floor_area">Floor Area (in sqm)</label>
                            <input 
                                type="number" 
                                id="floor_area" 
                                name="floor_area"
                                step="0.01"
                                placeholder="XXX"
                                value="{{ form_data.floor_area }}"
                                {% if errors.floor_area %}class="error"{% endif %}
                            >
                            {% if errors.floor_area %}<span class="error-message">{{ errors.floor_area }}</span>{% endif %}
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="button-group">
                        <button type="button" class="cancel-btn" onclick="openCancelModal()">Cancel</button>
                        <button type="button" class="confirm-btn" onclick="openConfirmModal()">Update Information</button>
                    </div>
                </form>
            {% endif %}
        </div>
    </div>

    <!-- Cancel Confirmation Modal -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <h2>Cancel Update?</h2>
            <p>Are you sure you want to cancel? Your changes will not be saved.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeCancelModal()">Continue Editing</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmCancel()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Update Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Update Property Information?</h2>
            <p>Please review your property information before confirming the update.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeConfirmModal()">Continue Editing</button>
                <button class="modal-btn modal-btn-confirm" onclick="submitForm()">Confirm</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
        function openCancelModal() {
            document.getElementById('cancelModal').classList.add('show');
        }

        function closeCancelModal() {
            document.getElementById('cancelModal').classList.remove('show');
        }

        function confirmCancel() {
            window.location.href = "{% url 'property_list' %}";
        }

        function openConfirmModal() {
            // Validate form before showing modal
            const form = document.getElementById('propertyForm');
            const inputs = form.querySelectorAll('input[type="text"]:not([disabled]), input[type="number"], select');
            let allFilled = true;

            inputs.forEach(input => {
                if (!input.value.trim()) {
                    allFilled = false;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                }
            });

            if (allFilled) {
                document.getElementById('confirmModal').classList.add('show');
            } else {
                alert('Please fill in all required fields.');
            }
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        function submitForm() {
            document.getElementById('propertyForm').submit();
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const cancelModal = document.getElementById('cancelModal');
            const confirmModal = document.getElementById('confirmModal');
            
            if (event.target === cancelModal) {
                closeCancelModal();
            }
            if (event.target === confirmModal) {
                closeConfirmModal();
            }
        });
    </script>
{% endblock %}
